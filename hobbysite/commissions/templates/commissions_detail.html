{% extends 'base.html' %}
{% load static %}

{% block title %} Commission Detail {% endblock %}

{% block content %}
    <div>
        <!-- Commission Details -->
        <h1 class=' fw-bold'>Commission Details</h1>
        <h3 class=' fw-bold'>{{ commission.title }}</h3>
        <p>By {{ commission.author }} created on: {{ commission.created_on }}</p>

        <p>Description {{ commission.description }}</p>
        <p>Status: {{ commission.status }}</p>
        <p>Updated {{ commission.updated_on }}</p>
    </div>

    <div>
        <!-- Job list -->
        <h3>Job List</h3>
        <ul>
            <!-- Job Details -->
          {% for item in job_data %}
            <li>
              <p> Role: {{ item.job.role }}<br>
                Required: {{ item.job.people_required }}<br>
                Accepted: {{ item.accepted_count }}<br>
                Open Slots: {{ item.open_slots }}<br>
              </p>

              <!-- The buttons T-T -->
              {% if request.user.is_authenticated %}
                {% if item.is_full %}
                    <button disabled>Job Full</button>
                {% else %}
                    <!-- If makes the apply button disabled or enabled -->
                    {% if request.user != commission.author %}
                      {% if item.already_applied %}
                        <button type="submit" disabled>Applied</button>
                      {% else %}
                        <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="job_id" value="{{ item.job.id }}">
                        <a href="{% url 'commissions:apply' commission.pk %}"><button type="button" >Apply</button></a>
                      {% endif %}
                    {% endif %}
                  </form>
                {% endif %}
              {% endif %}
            </li>
          {% endfor %}
        </ul>
    </div>

    {% if request.user == commission.author %}
        <a href="{% url 'commissions:edit' commission.pk %}"><button type="button" >Edit Commission</button></a>
    {% endif %}
    
{% endblock %}