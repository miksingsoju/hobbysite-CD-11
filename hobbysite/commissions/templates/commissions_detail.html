{% extends 'base.html' %}
{% load static %}

{% block title %} Commission Detail {% endblock %}

{% block content %}
    <!-- Commission Details -->
    <div>
        <h1 class=' fw-bold'>Commission Details</h1>
        <h3 class=' fw-bold'>{{ commission.title }}</h3>
        <p>By {{ commission.author }} created on: {{ commission.created_on }}</p>

        <p>Description {{ commission.description }}</p>
        <p>Status: {{ commission.status }}</p>
        <p>Updated {{ commission.updated_on }}</p>
    </div>

    <!-- Job list -->
    <div>
        <h3>Job List</h3>
        <ul>
            <!-- Job Details -->
          {% for item in job_data %}
            <li>
              <p> Role: {{ item.job.role }}<br>
                Required: {{ item.job.people_required }}<br>
                Accepted: {{ item.accepted_count }}<br>
                Open Slots: {{ item.open_slots }}<br>
              </p>

              <!-- Buttons -->
              <!-- If user is not the author -->
              {% if request.user.is_authenticated and request.user != commission.author %}
                <!-- If job is full then cannot apply -->
                {% if item.is_full %}
                    <button disabled>Job Full</button>
                {% else %}
                  <!-- If the user already applied to that job-->
                  {% if item.already_applied %}
                    <button type="submit" disabled>Applied</button>
                  {% else %}
                    <form method="post">
                    {% csrf_token %}
                    <input type="hidden" name="job_id" value="{{ item.job.id }}">
                    <button type="submit">Apply</button>
                    </form>
                  {% endif %}
                {% endif %}
              {% endif %}
              <!-- Job view to view and accept/reject applicants -->
              {% if request.user == commission.author %}
                <a href="{% url 'commissions:job' num=item.job.id %}"> <button type="button">View Applicants</button></a>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
    </div>

    <!-- Commission edit -->
    {% if request.user == commission.author %}
        <a href="{% url 'commissions:edit' commission.pk %}"><button type="button">Edit Commission</button></a>
    {% endif %}
    
{% endblock %}